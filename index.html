<!DOCTYPE html>
<html>
<head>
<title>JS car</title>
</head>
<body>
<svg width="500" height="500">
</svg>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.4.2/math.min.js"></script>
<script src="car.js"></script>
<script src="track.js"></script>
<script src="render.js"></script>
<script>

const curControls = {};

const keymap = {
  37: 'left',
  39: 'right',
  38: 'throttle',
  40: 'brake'
};

document.onkeydown = function(e) {
  if (keymap[e.keyCode]) {
    curControls[keymap[e.keyCode]] = true;
  }
};

document.onkeyup = function(e) {
  if (keymap[e.keyCode]) {
    curControls[keymap[e.keyCode]] = false;
  }
};

console.log('-----begin-----');

const track = new Track({ widthMeters: 5, heightMeters: 4 });
const svg = d3.select('svg');
const renderer = buildTrackRenderer(track, svg, 500, 500);
let t = new Date();

function draw() {

  const t0 = t;
  t = new Date();
  const dt = (t - t0) * 1e-3;
  track.move(dt, curControls);
  renderer();
  requestAnimationFrame(draw);
}
draw();

</script>
</body>
</html>
