<!DOCTYPE html>
<html>
<head>
<title>JS car</title>
</head>
<body>
<svg width="1000" height="800">
</svg>
<p id="speed-o-meter" style="text-align: right; width: 100px">
</p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.4.2/math.min.js"></script>
<script src="math-helpers.js"></script>
<script src="car.js"></script>
<script src="manual-steering.js"></script>
<script src="track.js"></script>
<script src="render.js"></script>
<script>

console.log('-----begin-----');

const scale = 0.3;
const track = new Track({ widthMeters: 5 / scale, heightMeters: 4 / scale });
const svg = d3.select('svg');
const renderer = buildTrackRenderer(track, svg,
  parseInt(svg.style('width'),10),
  parseInt(svg.style('height'),10));

const speedOMeter = document.getElementById('speed-o-meter');

let t = new Date();
let dt = 0.0;

const physicsDt = 0.01;
const steering = manualSteering();

function draw() {
  const t0 = t;
  t = new Date();
  dt += (t - t0) * 1e-3;
  while (dt >= physicsDt) {
    dt -= physicsDt;
    track.move(physicsDt, steering(track.car, dt));
  }
  renderer();
  speedOMeter.innerText = Math.round(track.car.getSpeed() * 3.6) + ' km/h';
  requestAnimationFrame(draw);
}
draw();

</script>
</body>
</html>
